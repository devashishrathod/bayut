generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id            String        @id @default(cuid())
  name          String
  type          CategoryType
  sortOrder     Int           @default(0)
  subCategories SubCategory[]
  properties    Property[]

  @@unique([type, name])
  @@index([type])
}

model SubCategory {
  id         String   @id @default(cuid())
  name       String
  sortOrder  Int      @default(0)
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])
  properties Property[]

  @@unique([categoryId, name])
  @@index([categoryId])
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String?
  phone        String?
  properties   Property[]
  isEmailVerified Boolean @default(false)
  emailOtpHash  String?
  emailOtpExpiresAt DateTime?
  emailOtpAttempts Int @default(0)
  resetPasswordTokenHash String?
  resetPasswordExpiresAt DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Property {
  id            String          @id @default(cuid())
  title         String
  description   String
  purpose       PropertyPurpose
  ownerId       String?
  owner         User?           @relation(fields: [ownerId], references: [id])
  categoryId    String
  category      Category        @relation(fields: [categoryId], references: [id])
  subCategoryId String?
  subCategory   SubCategory?    @relation(fields: [subCategoryId], references: [id])
  referenceNo   String?
  completion    CompletionStatus?
  truCheckOn    DateTime?
  handoverDate  String?
  price         Int
  bedrooms      Int
  bathrooms     Int
  areaSqft      Int
  rentFrequency RentFrequency?
  furnished     Boolean         @default(false)
  city          String
  community     String
  location      String?
  notes         String?
  urgency       Urgency?
  contactName   String?
  contactEmail  String?
  contactPhone  String?
  developerName String?
  ownership     OwnershipType?
  balconySizeSqft Int?
  parkingAvailable Boolean?
  buildingName  String?
  totalFloors   Int?
  swimmingPools Int?
  totalParkingSpaces Int?
  totalBuildingAreaSqft Int?
  elevators     Int?
  coverImageUrl String
  imageUrls     String[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  amenities     Amenity[]       @relation("AmenityToProperty")

  @@index([purpose])
  @@index([categoryId])
  @@index([subCategoryId])
  @@index([city])
  @@index([community])
  @@index([price])
  @@index([areaSqft])
  @@index([rentFrequency])
  @@index([ownerId])
}

model Amenity {
  id         String     @id @default(cuid())
  name       String     @unique
  properties Property[] @relation("AmenityToProperty")
}

enum PropertyPurpose {
  rent
  sale
}

enum CategoryType {
  residential
  commercial
}

enum RentFrequency {
  yearly
  monthly
  weekly
  daily
}

enum Urgency {
  this_month
  within_2_months
  flexible
}

enum CompletionStatus {
  ready
  off_plan
}

enum OwnershipType {
  freehold
  leasehold
}
